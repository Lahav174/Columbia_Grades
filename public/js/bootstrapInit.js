function ab(e){return e?"O":"X"}function filter(){document.getElementById("submitquery").disabled=!0,setTimeout(function(){document.getElementById("submitquery").disabled=!1},700);var e=null;e||(e=""),writeData("Statistics/Searches/"+dateOfLastSunday()+"/"+Date.now()+" "+$.cookie("userID"),"T: "+ab(filterTechnical)+", NT: "+ab(filterNonTechnical)+", GC: "+ab(filterGlobalCore)+", Min: "+minLevel/1e3+", Max: "+maxLevel/1e3+", SN: "+ab(filterSilver)+", GN: "+ab(filterGold));var t=searchDatabaseForSubstring(e);return(filterGold||filterSilver)&&(t=t.filter(function(e){var t=e.profName;if(filterGold)for(s=0;s<goldNuggets.professors.length;s++){var a=goldNuggets.professors[s].first_name,r=goldNuggets.professors[s].last_name;if(t.indexOf(a)>=0&&t.indexOf(r)>=0)return!0}if(filterSilver)for(var s=0;s<silverNuggets.professors.length;s++){var a=silverNuggets.professors[s].first_name,r=silverNuggets.professors[s].last_name;if(t.indexOf(a)>=0&&t.indexOf(r)>=0)return!0}return!1})),filterGlobalCore&&(t=t.filter(function(e){for(var t=e.id.split(" "),a=0;a<globalCores.length;a++){var r=globalCores[a];if(r.indexOf(t[0])>=0&&r.indexOf(t[1])>=0)return!0}return!1})),filterTechnical&&(t=t.filter(function(e){var t=e.id.split(" ");return-1!=$.inArray(t[0],techs)})),filterNonTechnical&&(t=t.filter(function(e){var t=e.id.split(" ");return-1!=$.inArray(t[0],nontechs)})),document.getElementById("levelcheckboxmin").checked&&(t=t.filter(function(e){var t=e.id.split(" ")[1];return 1e3*Number(t.charAt(t.length-4))>=minLevel})),document.getElementById("levelcheckboxmax").checked&&(t=t.filter(function(e){var t=e.id.split(" ")[1];return 1e3*Number(t.charAt(t.length-4))<=maxLevel})),t.sort(function(e,t){return e.ar<t.ar?1:t.ar<e.ar?-1:0}),setTable(0,t),$("#searchres").html('<font color="grey"><b>('+t.length+" Results)</b></font>"),t.length>0?$("#tableerror").html(""):$("#tableerror").html("<b>No results matched your search</b>"),firebase.database().ref().child("Statistics").once("value").then(function(e){"https:"==window.location.protocol&&writeData("Statistics/Search-Queries",e.val()["Search-Queries"]+1)})}function nextPage(){rightPageEnabled&&setTable(++pageNumber,tableData)}function lastPage(){leftPageEnabled&&setTable(--pageNumber,tableData)}function resize(){$(".popover").popover("hide")}function setTable(e,t){(rightPageEnabled=t.length>16*(e+1))?$("#rightarrow").html('<img src="assets/rightpage.png" style="height:20px;">'):$("#rightarrow").html('<img src="assets/rightpagedis.png" style="height:20px;">'),(leftPageEnabled=0!=e)?$("#leftarrow").html('<img src="assets/leftpage.png" style="height:20px;">'):$("#leftarrow").html('<img src="assets/leftpagedis.png" style="height:20px;">'),tableData=t,pageNumber=e,$("#pagenum").html("Page "+(e+1));var a="<thead>";a+='<tr class="active">',a+="<th>#</th>",a+="<th>Professor</th>",a+="<th>Course ID</th>",a+="<th>Course Name</th>",a+="<th>A-Range</th>",a+="</tr>",a+="</thead>",a+="<tbody>";for(var r=16*e;r<16*(e+1);r++)if(r<t.length){a+="<tr>",a+="<td>"+(r+1)+"</td>",t[r].profName.length<27?a+="<td>"+t[r].profName+"</td>":a+="<td>"+t[r].profName.substring(0,25)+"...</td>",a+="<td>"+t[r].id+"</td>",t[r].courseName.length<35?a+="<td>"+t[r].courseName+"</td>":a+="<td>"+t[r].courseName.substring(0,33)+"...</td>";var s="";s=100*t[r].ar%100>0?Math.floor(t[r].ar)+"% &plusmn "+Math.round(100*t[r].ar%100):t[r].ar;var n=firData.Departments[t[r].id.split(" ")[0]][t[r].id.split(" ")[1]].Professors[t[r].profName];a+='<td class="text-center" percentageDisplay><a style="color:#3A7FCF" href="#" data-toggle="popover" data-trigger="focus" data-html="true" title="Submissions ('+n.length+')" data-content="';for(var o=0;o<n.length;o++)a+=o+1+") "+n[o].arange+"% | ","date"in n[o]?a+=n[o].date.split(" ")[0]:a+="Before Oct. 2016",a+="<br>";a+='">'+s+"%</a></td>",a+="</tr>"}else a+="<tr>",a+='<td><img src="assets/whiteRect.png" id="nuggetimg"></td>',a+="<td></td>",a+="<td></td>",a+="<td></td>",a+="<td></td>",a+="</tr>";a+="</tbody>",$(document).ready(function(){$('[data-toggle="popover"]').popover().click(function(e){e.preventDefault()})}),document.getElementById("datatable").innerHTML=a}function cleanStr(e){for(var t=e.trim(),a=(t=t.toLowerCase()).split(" "),r="",s=0;s<a.length;s++)"i"!=a[s].toLowerCase()&&"ii"!=a[s].toLowerCase()&&"iii"!=a[s].toLowerCase()&&"iv"!=a[s].toLowerCase()&&"i:"!=a[s].toLowerCase()&&"ii:"!=a[s].toLowerCase()&&"iii:"!=a[s].toLowerCase()&&"iv:"!=a[s].toLowerCase()?r+=" "+a[s].charAt(0).toUpperCase()+a[s].substring(1):r+=" "+a[s].toUpperCase();return r.trim()}function dateOfLastSunday(){var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=["January","February","March","April","May","June","July","August","September","October","November","December"],a=e[(new Date).getDay()],r=e.indexOf(a),s=new Date;return s.setDate(s.getDate()-r),s.setHours(0,0,0,0),s.getYear()+1900+" ("+s.getWeekNumber()+") "+t[s.getMonth()]+" "+s.getDate()}function searchChange(){var e=retrieveElement("searchbar");if(0==e.length)$("#tableerror").html(""),setTable(0,[]),$("#searchres").html('<font color="grey"><b>Search Results</b></font>');else if(e.length<3)$("#tableerror").html("<b>Search must be at least 3 characters long</b>"),setTable(0,[]),$("#searchres").html('<font color="grey"><b>Search Results</b></font>');else{var t=searchDatabaseForSubstring(e);t.sort(function(e,t){return e.ar<t.ar?1:t.ar<e.ar?-1:0}),setTable(0,t),$("#searchres").html('<font color="grey"><b>('+t.length+" Results)</b></font>"),t.length>0?$("#tableerror").html(""):$("#tableerror").html("<b>No results matched your search</b>")}}function submitButtonPressed(){var e=retrieveElement("course-id"),t=e.split(" "),a=retrieveElement("course-name"),r=retrieveElement("prof-name"),s=retrieveElement("a-range");if(2!=t.length||4!=t[1].length&&5!=t[1].length&&6!=t[1].length||3!=t[0].length&&4!=t[0].length)$("#submissionerror").html("Please enter the course ID in the correct format");else if(a.split(" ").length<2)$("#submissionerror").html("Please enter the course name exactly as it is shown");else if(r.split(" ").length<2)$("#submissionerror").html("Please enter the full name of the professor");else{if(!(0==s.length||!$.isNumeric(s)||Number(s)<0||Number(s)>100)){$("#submissionerror").html("");var n=new Date;return submitData(r,e,a,s,n.toLocaleDateString()+" "+n.toLocaleTimeString()),$("#submitdataform")[0].reset(),firebase.database().ref().child("Statistics").once("value").then(function(e){writeData("Statistics/Submissions",e.val().Submissions+1)})}$("#submissionerror").html("Please enter the A-Range in the correct format")}}function searchDatabaseForSubstring(e){for(var t=e.toLowerCase(),a=[],r=Object.keys(firData.Departments),s=r.length-1;s>=0;s--)if(0==t.length||r[s].toLowerCase().indexOf(t)>=0)for(g=(h=Object.keys(firData.Departments[r[s]])).length-1;g>=0;g--){(d=Object.keys(firData.Departments[r[s]][h[g]].Names)).sort(function(e,t){var a=firData.Departments[r[s]][h[g]].Names[e].count,n=firData.Departments[r[s]][h[g]].Names[t].count;return a<n?1:n<a?-1:0});for(var n=firData.Departments[r[s]][h[g]].Names[d[0]].name,o=(v=Object.keys(firData.Departments[r[s]][h[g]].Professors)).length-1;o>=0;o--){for(var i=0,l=[],c=(D=firData.Departments[r[s]][h[g]].Professors[v[o]]).length-1;c>=0;c--)i+=D[c].arange/D.length,l.push(D[c].arange);var m=Math.min.apply(Math,l),u=Math.max.apply(Math,l),f={ar:(y=Math.round(i))+.01*Math.max(y-m,u-y),courseName:n,id:r[s]+" "+h[g],profName:v[o]};a.push(f)}}else for(var h=Object.keys(firData.Departments[r[s]]),g=h.length-1;g>=0;g--)if((r[s]+" "+h[g]).toLowerCase().indexOf(t)>=0){(d=Object.keys(firData.Departments[r[s]][h[g]].Names)).sort(function(e,t){var a=firData.Departments[r[s]][h[g]].Names[e].count,n=firData.Departments[r[s]][h[g]].Names[t].count;return a<n?1:n<a?-1:0});for(var n=firData.Departments[r[s]][h[g]].Names[d[0]].name,o=(v=Object.keys(firData.Departments[r[s]][h[g]].Professors)).length-1;o>=0;o--){for(var i=0,l=[],c=(D=firData.Departments[r[s]][h[g]].Professors[v[o]]).length-1;c>=0;c--)i+=D[c].arange/D.length,l.push(D[c].arange);var m=Math.min.apply(Math,l),u=Math.max.apply(Math,l),f={ar:(y=Math.round(i))+.01*Math.max(y-m,u-y),courseName:n,id:r[s]+" "+h[g],profName:v[o]};a.push(f)}}else{for(var d=Object.keys(firData.Departments[r[s]][h[g]].Names),b=!1,p=d.length-1;p>=0;p--)firData.Departments[r[s]][h[g]].Names[d[p]].name.toLowerCase().indexOf(t)>=0&&(b=!0);d.sort(function(e,t){var a=firData.Departments[r[s]][h[g]].Names[e].count,n=firData.Departments[r[s]][h[g]].Names[t].count;return a<n?1:n<a?-1:0});for(var n=firData.Departments[r[s]][h[g]].Names[d[0]].name,v=Object.keys(firData.Departments[r[s]][h[g]].Professors),o=v.length-1;o>=0;o--)if(b||v[o].toLowerCase().indexOf(t)>=0){for(var D=firData.Departments[r[s]][h[g]].Professors[v[o]],i=0,l=[],c=D.length-1;c>=0;c--)i+=D[c].arange/D.length,l.push(D[c].arange);var m=Math.min.apply(Math,l),u=Math.max.apply(Math,l),y=Math.round(i),f={ar:y+.01*Math.max(y-m,u-y),courseName:n,id:r[s]+" "+h[g],profName:v[o]};a.push(f)}}return a}function bootstrapInit(){var e={authDomain:"ezacu-716f6.firebaseapp.com",databaseURL:"https://ezacu-716f6.firebaseio.com",apiKey:"AIzaSyCmlkGhuP4VTZa4a-eAvzJZoopzu2Pqx4M",storageBucket:"ezacu-716f6.appspot.com",messagingSenderId:"467399916123"};firebase.initializeApp(e),document.getElementById("submitquery").disabled=!0;var t=firebase.database().ref();return t.on("value",function(e){if(this.firData=e.val(),firstRun){document.getElementById("submitquery").disabled=!1;for(var t=searchDatabaseForSubstring(""),a=new Set,r=new Set,s=new Set,n=0;n<t.length;n++)a.add(t[n].profName),r.add(t[n].courseName),s.add(t[n].id);var o=Array.from(r);o.sort();for(var i="",n=0;n<o.length;n++)i+='<option value="'+o[n]+'">';$("#courseNameList").html(i),(o=Array.from(s)).sort(),i="";for(n=0;n<o.length;n++)i+='<option value="'+o[n]+'">';$("#courseIdList").html(i),(o=Array.from(a)).sort(),i="";for(n=0;n<o.length;n++)i+='<option value="'+o[n]+'">';$("#profNameList").html(i),firstRun=!1}}),t.on("value",function(e){var t=e.val();$("#message").html("<b>"+t["Z-Message"]+"</b>")}),window.onresize=resize,setTable(0,[]),jQuery("button").click(function(e){switch(e.target.id){case"technical":document.getElementById("technical").className=filterTechnical?"btn btn-lg col-xs-12":"btn btn-lg col-xs-12 glowing",filterTechnical=!filterTechnical,filterNonTechnical=!1,document.getElementById("nontechnical").className="btn btn-lg col-xs-12 top15",filterGlobalCore=!1,document.getElementById("globalcore").className="btn btn-lg col-xs-12 top15";break;case"nontechnical":document.getElementById("nontechnical").className=filterNonTechnical?"btn btn-lg col-xs-12 top15":"btn btn-lg col-xs-12 top15 glowing",filterNonTechnical=!filterNonTechnical,filterTechnical=!1,document.getElementById("technical").className="btn btn-lg col-xs-12",filterGlobalCore=!1,document.getElementById("globalcore").className="btn btn-lg col-xs-12 top15";break;case"globalcore":document.getElementById("globalcore").className=filterGlobalCore?"btn btn-lg col-xs-12 top15":"btn btn-lg col-xs-12 top15 glowing",filterGlobalCore=!filterGlobalCore,filterTechnical=!1,document.getElementById("technical").className="btn btn-lg col-xs-12",filterNonTechnical=!1,document.getElementById("nontechnical").className="btn btn-lg col-xs-12 top15";break;case"goldnuggetbtn":case"goldnuggetimg":document.getElementById("goldnuggetbtn").className=filterGold?"btn btn-lg col-xs-5 col-xs-push-2":"btn btn-lg col-xs-5 col-xs-push-2 glowing",filterGold=!filterGold;break;case"silvernuggetbtn":case"silvernuggetimg":document.getElementById("silvernuggetbtn").className=filterSilver?"btn btn-lg col-xs-5 col-xs-push-0":"btn btn-lg col-xs-5 col-xs-push-0 glowing",filterSilver=!filterSilver}}),jQuery(".dropBtn").click(function(e){switch(e.preventDefault(),e.target.id){case"onekmin":minLevel=1e3;break;case"twokmin":minLevel=2e3;break;case"threekmin":minLevel=3e3;break;case"fourkmin":minLevel=4e3;break;case"fivekmin":minLevel=5e3;break;case"sixkmin":minLevel=6e3;break;case"onekmax":maxLevel=1e3;break;case"twokmax":maxLevel=2e3;break;case"threekmax":maxLevel=3e3;break;case"fourkmax":maxLevel=4e3;break;case"fivekmax":maxLevel=5e3;break;case"sixkmax":maxLevel=6e3;break;default:alert("The target id is: "+e.target.id+". This shouldn't happen.")}$("#minCover").html(minLevel+'   <span class="caret"></span>'),$("#maxCover").html(maxLevel+'   <span class="caret"></span>')}),window.addEventListener("beforeunload",function(e){var t=retrieveElement("searchbar");t.length>3&&writeData("Statistics/Searches/"+dateOfLastSunday()+"/"+Date.now()+" "+$.cookie("userID"),t)},!1),firebase.database().ref().child("Statistics").once("value").then(function(e){var t=e.val();if("https:"==window.location.protocol)if("userID"in $.cookie()&&$.cookie("userID")in t.Users){var a=$.cookie("userID");console.log("Old user:",a),writeData("Statistics/Users/"+a,t.Users[a]+1),"qxyru3"!=a&&"DAXO5F"!=a&&writeData("Statistics/Visits",t.Visits+1)}else{console.log("New user");var r=makeid(6);$.cookie("userID",r,{expires:1e3}),writeData("Statistics/Users/"+r,1),writeData("Statistics/Visits",t.Visits+1)}else console.log("Running Locally")})}function submitData(e,t,a,r,s){var n=t.split(" "),o=n[0].toUpperCase(),i=n[1].toUpperCase(),l=cleanStr(a),c=cleanStr(e),m=firData.Statistics["Submissions-Verb"];if(m.push($.cookie("userID")+": "+o+" "+i+" - "+l+" | "+c+" >> ("+r+"%)"),writeData("Statistics/Submissions-Verb",m),!firData.Departments.hasOwnProperty(o))return writeData("Departments/"+o+"/"+i+"/Professors/"+c,[{arange:r,date:s,contributor:$.cookie("userID")}]),void writeData("Departments/"+o+"/"+i+"/Names",[{name:l,count:1}]);for(var u=Object.keys(firData.Departments[o]),f=u.length-1;f>=0;f--){var h=u[f];if(h.substring(h.length-4)==i.substring(i.length-4)){for(var g=Object.keys(firData.Departments[o][h].Professors),d=[],f=g.length-1;f>=0;f--){var b=c.toLowerCase().split(" ");2==b.length&&g[f].split(" ").length>2&&-1!=g[f].toLowerCase().indexOf(b[0])&&-1!=g[f].toLowerCase().indexOf(b[1])?d.push({prof:g[f],lev:0}):d.push({prof:g[f],lev:levDist(g[f].toLowerCase(),c.toLowerCase())})}if(d.sort(function(e,t){return e.lev>t.lev?1:t.lev>e.lev?-1:0}),d[0].lev>4)writeData("Departments/"+o+"/"+h+"/Professors/"+c,[{arange:r,date:s,contributor:$.cookie("userID")}]);else{var p=firData.Departments[o][h].Professors[d[0].prof];p.push({arange:r,date:s,contributor:$.cookie("userID")}),writeData("Departments/"+o+"/"+h+"/Professors/"+d[0].prof,p)}for(var v=firData.Departments[o][h].Names,f=v.length-1;f>=0;f--)if(v[f].name==l)return v[f].count=v[f].count+1,void writeData("Departments/"+o+"/"+h+"/Names",v);return v.push({name:l,count:1}),void writeData("Departments/"+o+"/"+h+"/Names",v)}}writeData("Departments/"+o+"/"+i+"/Professors/"+c,[{arange:r,date:s,contributor:$.cookie("userID")}]),writeData("Departments/"+o+"/"+i+"/Names",[{name:l,count:1}])}function retrieveElement(e){return document.getElementById(e).value}function writeData(e,t){firebase.database().ref().child(e).set(t)}function makeid(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function levDist(e,t){var a=[],r=e.length,s=t.length;if(0==r)return s;if(0==s)return r;for(n=r;n>=0;n--)a[n]=[];for(n=r;n>=0;n--)a[n][0]=n;for(i=s;i>=0;i--)a[0][i]=i;for(var n=1;n<=r;n++)for(var o=e.charAt(n-1),i=1;i<=s;i++){if(n==i&&a[n][i]>4)return r;var l=t.charAt(i-1),c=o==l?0:1,m=a[n-1][i]+1,u=a[n][i-1]+1,f=a[n-1][i-1]+c;u<m&&(m=u),f<m&&(m=f),a[n][i]=m,n>1&&i>1&&o==t.charAt(i-2)&&e.charAt(n-2)==l&&(a[n][i]=Math.min(a[n][i],a[n-2][i-2]+c))}return a[r][s]}var firData,savedSearch="nil",numBackspace=0,filterGlobalCore=!1,filterTechnical=!1,filterNonTechnical=!1,minLevel=1e3,maxLevel=4e3,filterGold=!1,filterSilver=!1,tableData=[],pageNumber=0,leftPageEnabled=!1,rightPageEnabled=!1,firstRun=!0,ipAddress="";$("#searchbar").keydown(function(e){document.getElementById("searchbar");var t=e.which;console.log("Build 290"),8==t&&0==numBackspace?(savedSearch=retrieveElement("searchbar").trim(),numBackspace++):8==t&&2!=numBackspace?numBackspace++:8==t&&2==numBackspace?(savedSearch.length>3&&writeData("Statistics/Searches/"+dateOfLastSunday()+"/"+Date.now()+" "+$.cookie("userID"),savedSearch),numBackspace++):numBackspace=0}),Date.prototype.getWeekNumber=function(){var e=new Date(+this);return e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7)),Math.ceil(((e-new Date(e.getFullYear(),0,1))/864e5+1)/7)},$("#searchForm").submit(function(){return!1}),$("#filterform").submit(function(){return!1});